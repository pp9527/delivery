<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">

    <title>Dynamic Table</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link href="/css/jquery.stepy.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/style-responsive.css" rel="stylesheet">


    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>

    <div th:include="common::commonheader"></div>

    <style>
        tr, th {
            text-align: center;
        }
        /*地图标记大小样式*/
        .amap-icon img,
         .amap-marker-content img{
             width: 25px;
             height: 34px;
         }
    </style>

</head>

<body class="sticky-header" style="height: 100%;">

<section>
    <div th:replace="common :: leftmenu"></div>

    <!-- main content start-->
    <div class="main-content" style="min-height: 100%;top: 50px;">
        <!--        <div style="width:100%;height: 100%;background-color: #eff0f4">-->
        <div th:replace="common :: headermenu"></div>

        <!-- page heading start-->
        <div class="page-heading">
            <h3>
                Order Management
            </h3>
            <ul class="breadcrumb">
                <li>
                    <a href="main.html">Home</a>
                </li>
                <li class="active">Order Management</li>
            </ul>
        </div>
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper" style="height: 771px;">
            <div class="row">
                <div class="col-md-12">
                    <section class="newPanel" style="background-color: white">

                        <div class="panel-body">
                            <div class="adv-table">
                                <div class="col-md-6">
                                    <button type="button" style="margin-bottom: 5px;" class="col-md-2 btn btn-info"
                                            data-toggle="modal" data-target="#myModal2">新增
                                    </button>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="col-md-8 col-md-offset-2">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <input class="form-control" type="text" placeholder="Input ID">
                                            </div>
                                            <div class="col-md-4">
                                                <button class="btn btn-primary" type="submit">Search</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button"
                                                class="col-md-12 btn btn-default dropdown-toggle"
                                                data-toggle="dropdown">
                                            Filters<span class="caret"></span></button>
                                        <ul class="dropdown-menu">
                                            <li><a href="#">Action</a></li>
                                            <li><a href="#">Another action</a></li>
                                            <li><a href="#">Something else here</a></li>
                                        </ul>
                                    </div>


                                </div>
                                <table class="table table-hover table-bordered">

                                    <thead>
                                    <tr>
                                        <th>orderID</th>
                                        <th>goods</th>
                                        <th>transportation model</th>
                                        <th>start station</th>
                                        <th>destination</th>
                                        <th>time/min</th>
                                        <th>weight/kg</th>
                                        <th>order info</th>
                                        <th>order route</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="order:${orders.getRecords()}">
                                        <td th:text="${order.orderId}"></td>
                                        <td th:text="${order.goods}"></td>
                                        <td th:if="${order.model} == 1">cooperate</td>
                                        <td th:if="${order.model} == 2">uav</td>
                                        <td th:if="${order.model} == 3">ugv</td>
                                        <td th:text="${order.startStation}"></td>
                                        <td th:text="${order.consignee}"></td>
                                        <td th:text="${order.deadline}"></td>
                                        <td th:text="${order.weight}"></td>
                                        <td th:text="${order.info}"></td>
                                        <td th:text="${order.route}"></td>
                                    </tr>
                                    </tbody>
                                </table>

                                <nav class="col-md-3 col-md-offset-9" aria-label="...">
                                    <ul class="pagination">
                                        <li><a th:href="@{/orders(pn=1)}">first</a></li>

                                        <li th:class="${num == orders.current?'active':''}" th:each="num:${navNums}">
                                            <a th:href="@{/orders(pn=${num})}">[[${num}]]</a></li>
                                        <li><a th:href="@{/orders(pn=${orders.pages})}">last</a></li>
                                    </ul>
                                </nav>
                            </div>

                        </div>
                    </section>
                </div>
            </div>

        </div>
        <!--body wrapper end-->

        <!--footer section start-->
        <footer style="text-align: center;margin-top: 5px;margin-bottom: 0px;">
            2022 &copy; AdminEx by AHU ISEC
        </footer>
        <!--footer section end-->
        <!--        </div>-->


    </div>
    <!-- main content end-->

    <!-- 模态框（Modal2） -->
    <div class="modal fade form-horizontal" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="border-radius: 10px;font-size: 18px;font-weight: bolder">
                <div class="modal-header" style="border-top-left-radius: 10px;border-top-right-radius: 10px;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel2" style="font-weight: bolder">Creating a New Order</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="square-widget">
                                <div class="widget-container">
                                    <div class="stepy-tab"></div>
                                    <form id="default" th:action="@{/insertOrder}" method="post">
                                        <fieldset title="Order Info" style="margin: 0;padding-bottom: 20px;">
                                            <legend>Detailed Information</legend>
                                            <div class="row" style="margin-bottom: 15px;">
                                                <div class="col-md-4" style="vertical-align: middle">
                                                    <span>transportation mode：</span>
                                                </div>
                                                <div class="col-md-8" style="color: green;vertical-align: middle">
                                                    <label class="radio-inline;"
                                                           style="padding: 0;font-weight: bold;display: inline-block;margin-right: 20px;">
                                                        <input style="vertical-align: middle;margin: 0" type="radio"
                                                               name="model"
                                                               id="Radio1"
                                                               value="2">
                                                        <span>only uav</span>
                                                    </label>
                                                    <label class="radio-inline;"
                                                           style="padding: 0;font-weight: bold;display: inline-block;margin-right: 20px;">
                                                        <input style="vertical-align: middle;margin: 0" type="radio"
                                                               name="model"
                                                               id="Radio2"
                                                               value="3">
                                                        <span>only ugv</span>
                                                    </label>
                                                    <label class="radio-inline;"
                                                           style="padding: 0;font-weight: bold;display: inline-block">
                                                        <input style="vertical-align: middle;margin: 0" type="radio"
                                                               name="model"
                                                               id="Radio3"
                                                               value="1">
                                                        <span>uav and ugv</span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="row" style="margin-bottom: 10px;">
                                                <div class="col-md-3"><span>start station：</span></div>
                                                <div class="col-md-3"><span>consignee：</span></div>
                                                <div class="col-md-3"><span>orderID：</span></div>
                                                <div class="col-md-3"><span>time：</span></div>
                                            </div>
                                            <div class="row" style="margin-bottom: 15px;">
                                                <div class="col-md-3">
                                                    <input type="text" name="startStation" class="form-control"
                                                           placeholder="W1">
                                                </div>
                                                <div class="col-md-3">
                                                    <input type="text" name="consignee" class="form-control"
                                                           placeholder="U1 to U4">
                                                </div>
                                                <div class="col-md-3">
                                                    <input type="text" name="orderId" class="form-control"
                                                           placeholder="five figure">
                                                </div>
                                                <div class="col-md-3">
                                                    <input type="text" name="deadline" class="form-control"
                                                           placeholder="time/min">
                                                </div>
                                            </div>

                                            <div class="row" style="margin-bottom: 30px;">
                                                <label class="col-md-2 control-label"
                                                       style="font-weight: bold;">order note：</label>
                                                <div class="col-md-10">
                                                    <textarea name="info" rows="6" class="form-control"></textarea>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <fieldset title="Service Composition Strategy"
                                                  style="margin: 0;padding-bottom: 20px;">
                                            <legend>Service Composition Strategy Details</legend>
                                            <div class="row" style="margin-bottom: 30px;">
                                                <div class="col-md-4 text-center" style="line-height: 34px;">
                                                    <span>optimization objective：</span></div>
                                                <div class="col-md-6">
                                                    <select class="form-control" name="objective">
                                                        <option>distance</option>
                                                        <option>time</option>
                                                        <option>energy</option>
                                                        <option value="energyInTime">energy consumption optimization
                                                            under time constraint
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2 text-center">
                                                    <button type="button" onclick="sendAjax()" class="btn btn-primary">
                                                        generate
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="map_container" class="col-md-12"
                                                 style="display: none;background-color: white;height: 500px;padding: 10px;border-radius: 10px;">
                                                <div id="container"
                                                     style="position: relative;width: 100%;height: 100%;border-radius: 10px;">
                                                    <!--                                                    <div style="position:relative;z-index: 100;width: 200px;height: 70px;-->
                                                    <!--                                                    background-color: white;margin-left: 10px;top: 10px;border-radius: 5px;">-->
                                                    <!--                                                        <div>no load  middle</div>-->
                                                    <!--                                                        <div id="timeAndEnergy"></div>-->

                                                    <!--                                                    </div>-->
                                                </div>
                                            </div>


                                        </fieldset>
                                        <fieldset title="Service Distribution Strategy"
                                                  style="margin: 0;padding-bottom: 20px;">
                                            <legend>Service Distribution Strategy Details</legend>
                                            <div class="row" style="margin-bottom: 15px;">
                                                <div class="col-md-2 text-center" style="line-height: 34px;">
                                                    <span>uav type：</span></div>
                                                <div class="col-md-3">
                                                    <select class="form-control" name="uavType">
                                                        <option value="1">small</option>
                                                        <option value="2">middle</option>
                                                        <option value="3">large</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2 text-center" style="line-height: 34px;">
                                                    <span>ugv type：</span></div>
                                                <div class="col-md-3">
                                                    <select class="form-control" name="ugvType">
                                                        <option value="1">small</option>
                                                        <option value="2">middle</option>
                                                        <option value="3">large</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2 text-center">
                                                    <button type="button" onclick="getRoute()" class="btn btn-primary">
                                                        generate
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="row" style="margin-bottom: 10px;">
                                                <div class="col-md-2 text-center"><span>goods info：</span></div>
                                            </div>
                                            <div class="row" style="margin-bottom: 15px;">
                                                <div class="col-md-3">
                                                    <input type="text" name="goods" class="form-control"
                                                           placeholder="name of goods">
                                                </div>
                                                <div class="col-md-3">
                                                    <input type="text" name="length" class="form-control"
                                                           placeholder="length/cm">
                                                </div>
                                                <div class="col-md-3">
                                                    <input type="text" name="width" class="form-control"
                                                           placeholder="width/cm">
                                                </div>
                                                <div class="col-md-3">
                                                    <input type="text" name="weight" class="form-control"
                                                           placeholder="weight/kg">
                                                </div>
                                            </div>
                                            <div id="map_container_1" class="col-md-12"
                                                 style="display: none;background-color: white;height: 500px;padding: 10px;border-radius: 10px;">
                                                <div id="container_1"
                                                     style="position: relative;width: 100%;height: 100%;border-radius: 10px;"></div>
                                            </div>


                                        </fieldset>
                                        <button type="submit" class="btn btn-success finish">
                                            Finish
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

</section>

<div th:replace="common :: commonscript"></div>


<!--Dashboard Charts-->
<!--<script src="/js/dashboard-chart-init.js"></script>-->
<script src="/js/jquery.validate.min.js"></script>
<script src="/js/jquery.stepy.js"></script>
<!--<script src="/js/jquery-3.4.1.min.js"></script>-->

<!--<script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/jquery-1.11.1.min.js" ></script>-->
<script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/underscore-min.js"></script>
<script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/backbone-min.js"></script>
<script type="text/javascript" src='https://a.amap.com/jsapi_demos/static/demo-center/js/prety-json.js'></script>

<script>
    // var map = new AMap.Map("container", {
    //     // center: [112.187017,31.763388],
    //     resizeEnable: true,
    //     zoom: 11
    // });
</script>
<script type="text/javascript">
    window._AMapSecurityConfig = {
        securityJsCode: '2f8af7c5b6908ba48f1e68c3fe9744ce',
    }
</script>
<script src="https://webapi.amap.com/maps?v=2.0&key=9802c49d608a80962ed05ccdc9de7723&plugin=AMap.Driving"></script>
<script>


    /*=====STEPY WIZARD====*/
    $(function () {
        $('#default').stepy({
            backLabel: 'Previous',
            block: true,
            nextLabel: 'Next',
            titleClick: true,
            titleTarget: '.stepy-tab'
        });
    });
    /*=====STEPY WIZARD WITH VALIDATION====*/
    // $(function () {
    //     $('#stepy_form').stepy({
    //         backLabel: 'Back',
    //         nextLabel: 'Next',
    //         errorImage: true,
    //         block: true,
    //         description: true,
    //         legend: false,
    //         titleClick: true,
    //         titleTarget: '#top_tabby',
    //         validate: true
    //     });
    //     $('#stepy_form').validate({
    //         errorPlacement: function (error, element) {
    //             $('#stepy_form div.stepy-error').append(error);
    //         },
    //         rules: {
    //             'name': 'required',
    //             'email': 'required'
    //         },
    //         messages: {
    //             'name': {
    //                 required: 'Name field is required!'
    //             },
    //             'email': {
    //                 required: 'Email field is requerid!'
    //             }
    //         }
    //     });
    // });

    // 参数列表
    // model、startStation、consignee、orderId、type、length、width、height、weight、info、
    // objective


    function sendAjax() {
        const model = $("[name='model']:checked").val();
        const startStation = $("[name='startStation']").val();
        const consignee = $("[name='consignee']").val();
        const objective = $("[name='objective']").val();
        const deadline = $("[name='deadline']").val();
        $.ajax({
            url: "/ajax/generate",
            type: "post",
            data: {
                model: model,
                startStation: startStation,
                consignee: consignee,
                objective: objective,
                deadline: deadline
            },
            dataType: "json",
            success: function (data) {
                if (data == null) {
                    alert("该条件下没有可行的服务方案，请修改订单信息！")
                }
                // data = [
                //          [
                //            [路径途径站点坐标],
                //            [路径途径站点坐标],
                //            ....
                //            [
                //              [路径总时间],
                //              [路径总时间]
                //            ]
                //          ],
                //          [
                //            [用户坐标]
                //          ]

                // 开始放在地图最后显示div，会出现首次生成路径时地图自适应属性失效的问题，解决办法：放在地图加载之前
                var t = document.getElementById('map_container');
                t.style.display = 'block';

                var map = new AMap.Map("container", {
                    // center: [112.187017,31.763388],
                    resizeEnable: true,
                    zoom: 14
                });

                // var pathData = [];
                // for (let i = 0; i < data[0].length - 1; i++) {
                //     pathData[i] = data[0][i];
                // }
                var polyline = new AMap.Polyline({
                    path: data[1],
                    isOutline: true,
                    outlineColor: '#ffeeff',
                    borderWeight: 3,
                    strokeColor: "#f0f",
                    strokeOpacity: 1,
                    strokeWeight: 6,
                    // 折线样式还支持 'dashed'
                    strokeStyle: "dashed",
                    // strokeStyle是dashed时有效
                    strokeDasharray: [15, 5],
                    lineJoin: 'round',
                    lineCap: 'round',
                    zIndex: 50,
                })
                map.add(polyline);

                // var text1 = new AMap.Text({
                //     text: startStation,
                //     anchor: 'top-left', // 设置文本标记锚点
                //     draggable: true,
                //     cursor: 'pointer',
                //     style: {
                //         'padding': '.75rem 1.25rem',
                //         'margin-bottom': '1rem',
                //         'border-radius': '.40rem',
                //         'background-color': 'white',
                //         'width': '6rem',
                //         'border-width': 0,
                //         'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                //         'text-align': 'center',
                //         'font-size': '20px',
                //         'color': 'green',
                //         'x-index': '10000'
                //     },
                //     position: data[1][0]
                // });
                // var text2 = new AMap.Text({
                //     text: consignee,
                //     anchor: 'top-left', // 设置文本标记锚点
                //     draggable: true,
                //     cursor: 'pointer',
                //     style: {
                //         'padding': '.75rem 1.25rem',
                //         'margin-bottom': '1rem',
                //         'border-radius': '.40rem',
                //         'background-color': 'white',
                //         'width': '6rem',
                //         'border-width': 0,
                //         'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                //         'text-align': 'center',
                //         'font-size': '20px',
                //         'color': 'red',
                //         'x-index': '10000'
                //     },
                //     position: data[3]
                // });
                // text1.setMap(map);
                // text2.setMap(map);

                for (let i = 1; i < data[0].length - 1; i++) {
                    // 以不同颜色标出不同种类站点名  仓库：绿色  无人机站点：红色  无人车站点：黑色
                    let color;
                    if (data[0][i][0] == 'W') {
                        color = 'green';
                    } else if (data[0][i][0] == 'D') {
                        color = 'red';
                    } else {
                        color = 'black';
                    }
                    // 标出站点标记
                    let marker = new AMap.Marker({
                        icon: '/icon/poi-marker-' + color + '.png',
                        position: data[1][i],
                        offset: new AMap.Pixel(-13, -30)
                    });
                    marker.setMap(map);
                }

                for (let i = 0; i < data[0].length; i++) {
                    // 以不同颜色标出不同种类站点名  仓库：绿色  无人机站点：红色  无人车站点：黑色
                    let color;
                    if (data[0][i][0] == 'W') {
                        color = 'green';
                    } else if (data[0][i][0] == 'D') {
                        color = 'red';
                    } else {
                        color = 'black';
                    }
                    let text = new AMap.Text({
                        text:data[0][i],
                        anchor:'top-left', // 设置文本标记锚点
                        draggable:true,
                        cursor:'pointer',
                        style:{
                            'padding': '.5rem .75rem',
                            'margin-bottom': '1rem',
                            'border-radius': '.40rem',
                            'background-color': 'white',
                            'width': '6rem',
                            'border-width': 0,
                            'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                            'text-align': 'center',
                            'font-size': '15px',
                            'font-weight': 'bolder',
                            'color': color,
                            'x-index':'10000'
                        },
                        position: data[1][i]
                    });
                    text.setMap(map);
                }

                // 终点坐标文本
                let text1 = new AMap.Text({
                    text:consignee,
                    anchor:'top-left', // 设置文本标记锚点
                    draggable:true,
                    cursor:'pointer',
                    style:{
                        'padding': '.5rem .75rem',
                        'margin-bottom': '1rem',
                        'border-radius': '.40rem',
                        'background-color': 'white',
                        'width': '6rem',
                        'border-width': 0,
                        'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                        'text-align': 'center',
                        'font-size': '15px',
                        'font-weight': 'bolder',
                        'color': 'blue',
                        'x-index':'10000'
                    },
                    position: data[3]
                });
                text1.setMap(map);

                var drivingOption = {
                    policy: AMap.DrivingPolicy.LEAST_TIME, // 其它policy参数请参考 https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingPolicy
                    ferry: 1, // 是否可以使用轮渡
                    map: map,
                    autoFitView: false,
                    // panel: 'panel'
                }
                var driving = new AMap.Driving(drivingOption)
                // 根据起终点经纬度规划驾车导航路线
                driving.search(new AMap.LngLat(data[1][data[1].length - 1][0], data[1][data[1].length - 1][1]), new AMap.LngLat(data[3][0], data[3][1]), function (status, result) {
                    // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
                    if (status === 'complete') {
                    } else {
                        log.error('获取驾车数据失败：' + result)
                    }
                });

                var startIcon = new AMap.Icon({
                    size: new AMap.Size(25, 34),
                    image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png',
                    imageSize: new AMap.Size(135, 40),
                    imageOffset: new AMap.Pixel(-9, -3)
                });
                // var content1 = '<div class="marker-route marker-marker-bus-from"></div>';
                var marker1 = new AMap.Marker({
                    // content: markerContent,
                    icon: startIcon,
                    // icon: "//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png",
                    position: data[1][0],
                    offset: new AMap.Pixel(-17, -25),
                });
                var endIcon = new AMap.Icon({
                    size: new AMap.Size(25, 34),
                    image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png',
                    imageSize: new AMap.Size(135, 40),
                    imageOffset: new AMap.Pixel(-50, -3)
                });
                var marker2 = new AMap.Marker({
                    icon: endIcon,
                    // icon: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-via-marker.png',
                    position: data[1][data[1].length - 1],
                    offset: new AMap.Pixel(-14, -29),
                });
                map.add([marker1, marker2])
                map.setFitView(null, true, [40, 40, 50, 50]);

                if (data == null) {
                    alert("该条件下没有可行的服务方案，请修改订单信息！")
                } else {
                    alert("方案已生成，点击确认查看！\n" + "该方案预计总时间："
                        + data[2][0] + "min, 总能耗："
                        + data[2][1] + "kj");
                }

                // var t = document.getElementById('map_container');
                // t.style.display = 'block';
            }
        })
    }

    function getRoute() {
        const model = $("[name='model']:checked").val();
        const startStation = $("[name='startStation']").val();
        const consignee = $("[name='consignee']").val();
        const objective = $("[name='objective']").val();
        const uavType = $("[name='uavType']").val();
        const ugvType = $("[name='ugvType']").val();
        const deadline = $("[name='deadline']").val();
        const weight = $("[name='weight']").val();
        $.ajax({
            url: "/ajax/getRoute",
            type: "post",
            data: {
                model: model,
                startStation: startStation,
                consignee: consignee,
                objective: objective,
                uavType: uavType,
                ugvType: ugvType,
                deadline: deadline,
                weight: weight
            },
            dataType: "json",
            success: function (data) {
                // data = [
                //          [
                //            [路径途径站点坐标],
                //            [路径途径站点坐标],
                //            ....
                //            [
                //              [路径总时间],
                //              [路径总时间]
                //            ]
                //          ],
                //          [
                //            [用户坐标]
                //          ]
                // 开始放在地图最后显示div，会出现首次生成路径时地图自适应属性失效的问题，解决办法：放在地图加载之前
                var t = document.getElementById('map_container_1');
                t.style.display = 'block';

                if (data == null) {
                    alert("该条件下没有可行的服务方案，请修改订单信息！")
                } else if (data[0][0] == -1) {
                    alert("当前无人机无法承受当前负载！请选择更大无人机！")
                } else if (data[0][1] == -2) {
                    alert("当前无人车无法承受当前负载！请选择更大无人车！")
                } else {
                    alert("方案已生成，点击确认查看！\n" + "该方案预计总时间："
                        + data[2][0] + "min, 总能耗："
                        + data[2][1] + "kj");
                }

                var map = new AMap.Map("container_1", {
                    // center: [112.187017,31.763388],
                    resizeEnable: true,
                    zoom: 14
                });


                var polyline = new AMap.Polyline({
                    path: data[1],
                    isOutline: true,
                    outlineColor: '#ffeeff',
                    borderWeight: 3,
                    strokeColor: "#f0f",
                    strokeOpacity: 1,
                    strokeWeight: 6,
                    // 折线样式还支持 'dashed'
                    strokeStyle: "dashed",
                    // strokeStyle是dashed时有效
                    strokeDasharray: [15, 5],
                    lineJoin: 'round',
                    lineCap: 'round',
                    zIndex: 50,
                })
                map.add(polyline);

                for (let i = 1; i < data[0].length - 1; i++) {
                    // 以不同颜色标出不同种类站点名  仓库：绿色  无人机站点：红色  无人车站点：黑色
                    let color;
                    if (data[0][i][0] == 'W') {
                        color = 'green';
                    } else if (data[0][i][0] == 'D') {
                        color = 'red';
                    } else {
                        color = 'black';
                    }
                    // 标出站点标记
                    let marker = new AMap.Marker({
                        icon: '/icon/poi-marker-' + color + '.png',
                        position: data[1][i],
                        offset: new AMap.Pixel(-13, -30)
                    });
                    marker.setMap(map);
                }

                for (let i = 0; i < data[0].length; i++) {
                    // 以不同颜色标出不同种类站点名  仓库：绿色  无人机站点：红色  无人车站点：黑色
                    let color;
                    if (data[0][i][0] == 'W') {
                        color = 'green';
                    } else if (data[0][i][0] == 'D') {
                        color = 'red';
                    } else {
                        color = 'black';
                    }
                    let text = new AMap.Text({
                        text:data[0][i],
                        anchor:'top-left', // 设置文本标记锚点
                        draggable:true,
                        cursor:'pointer',
                        style:{
                            'padding': '.5rem .75rem',
                            'margin-bottom': '1rem',
                            'border-radius': '.40rem',
                            'background-color': 'white',
                            'width': '6rem',
                            'border-width': 0,
                            'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                            'text-align': 'center',
                            'font-size': '15px',
                            'font-weight': 'bolder',
                            'color': color,
                            'x-index':'10000'
                        },
                        position: data[1][i]
                    });
                    text.setMap(map);
                }

                // 终点坐标文本
                let text1 = new AMap.Text({
                    text:consignee,
                    anchor:'top-left', // 设置文本标记锚点
                    draggable:true,
                    cursor:'pointer',
                    style:{
                        'padding': '.5rem .75rem',
                        'margin-bottom': '1rem',
                        'border-radius': '.40rem',
                        'background-color': 'white',
                        'width': '6rem',
                        'border-width': 0,
                        'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                        'text-align': 'center',
                        'font-size': '15px',
                        'font-weight': 'bolder',
                        'color': 'blue',
                        'x-index':'10000'
                    },
                    position: data[3]
                });
                text1.setMap(map);

                var drivingOption = {
                    policy: AMap.DrivingPolicy.LEAST_TIME, // 其它policy参数请参考 https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingPolicy
                    ferry: 1, // 是否可以使用轮渡
                    map: map,
                    autoFitView: false,
                    // panel: 'panel'
                }
                var driving = new AMap.Driving(drivingOption)
                // 根据起终点经纬度规划驾车导航路线
                driving.search(new AMap.LngLat(data[1][data[1].length - 1][0], data[1][data[1].length - 1][1]), new AMap.LngLat(data[3][0], data[3][1]), function (status, result) {
                    // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
                    if (status === 'complete') {
                    } else {
                        log.error('获取驾车数据失败：' + result)
                    }
                });

                var startIcon = new AMap.Icon({
                    size: new AMap.Size(25, 34),
                    image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png',
                    imageSize: new AMap.Size(135, 40),
                    imageOffset: new AMap.Pixel(-9, -3)
                });
                // var content1 = '<div class="marker-route marker-marker-bus-from"></div>';
                var marker1 = new AMap.Marker({
                    // content: markerContent,
                    icon: startIcon,
                    // icon: "//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png",
                    position: data[1][0],
                    offset: new AMap.Pixel(-17, -25),
                });
                var endIcon = new AMap.Icon({
                    size: new AMap.Size(25, 34),
                    image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png',
                    imageSize: new AMap.Size(135, 40),
                    imageOffset: new AMap.Pixel(-50, -3)
                });
                var marker2 = new AMap.Marker({
                    icon: endIcon,
                    // icon: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-via-marker.png',
                    position: data[1][data[1].length - 1],
                    offset: new AMap.Pixel(-14, -29),
                });
                map.add([marker1, marker2])
                map.setFitView(null, true, [40, 40, 50, 50]);

                // var t = document.getElementById('map_container');
                // t.style.display = 'block';
            }
        })
    }


</script>

</body>
</html>