<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" style="height: 100%;">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords"
          content="admin, dashboard, bootstrap, template, flat, modern, theme, responsive, fluid, retina, backend, html5, css, css3">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">


    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
<!--    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />-->
    <link rel="stylesheet" type="text/css" href="https://a.amap.com/jsapi_demos/static/demo-center/css/prety-json.css">


    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode:'2f8af7c5b6908ba48f1e68c3fe9744ce',
        }
    </script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=9802c49d608a80962ed05ccdc9de7723&plugin=AMap.Driving"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
<!--    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>-->

    <link rel="shortcut icon" href="#" type="image/png">

    <title>Delivery System</title>


    <div th:include="common::commonheader"></div>

    <style type="text/css">
        .my_style_a1:hover{
            font-weight: bolder;
        }
        .amap-icon img,
        .amap-marker-content img{
            width: 25px;
            height: 34px;
        }
        .my_style_a2{
            color: black;
        }

    </style>

</head>

<body class="sticky-header" style="height: 100%;">

<section>
    <div th:replace="common :: leftmenu"></div>

    <!-- main content start-->
    <div class="main-content" style="min-height: 100%;">

        <div th:replace="common :: headermenu"></div>


        <!--body wrapper start-->
        <div class="wrapper">
            <div class="col-md-4">

                <div class="row" style="padding-bottom: 10px;">
                    <div class="row center-block" style="margin-bottom: 20px;">
                        <h3>Active Orders：100</h3>
                    </div>
                    <form role="form" class="form-inline">
                        <div class="form-group col-md-6">
                            <input type="text" style="width: 100%" placeholder="Input" class="form-control input-lg">
                        </div>
                        <button class="btn btn-primary col-md-2 input-lg" type="submit">Search</button>
                        <div class="dropdown col-md-offset-1 col-md-2">
                            <button type="button" class="input-lg btn btn-default dropdown-toggle"
                                    data-toggle="dropdown">
                                Filters<span class="caret"></span></button>
                            <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something else here</a></li>
                            </ul>
                        </div>
                    </form>
                </div>

                <div class="row" style="height:690px;overflow:auto; position: relative;margin-right: 1px;">
                    <div class="row col-md-12" style="margin-top: 20px;padding-right: 0px;">
                        <div class="col-md-12" style="padding: 0px;">
                            <div class="panel newPanel" th:each="order:${activeOrders}">
                                    <div class="panel-body">
                                        <div class="row">
                                            <h4 class="col-md-3"><strong th:text="${order.orderId}">ID</strong></h4>
                                            <h4 class="col-md-offset-9" style="padding: 0px;">
                                            <a class="btn btn-primary" style="border-radius: 15px;font-size: 15px;padding: 2px;"
                                                  th:if="${order.status} == 0" th:href="@{'/main/'+${order.id}}">
                                                Unshipped
                                            </a>
                                                <a class="btn btn-success" style="border-radius: 15px;font-size: 15px;padding: 2px;"
                                                      th:if="${order.status} == 1" th:href="@{'/main/'+${order.id}}">
                                                In transit
                                            </a>
                                                <a class="btn btn-danger" style="border-radius: 15px;font-size: 15px;padding: 2px;"
                                                      th:if="${order.status} == 2" th:href="@{'/main/'+${order.id}}">
                                                Idle timeout
                                            </a>
                                            </h4>
                                        </div>
                                        <div class="row">
                                            <p class="col-md-12" th:text="${order.goods}"></p>
                                        </div>
                                        <div class="row">
                                            <p class="col-md-3">23 Apr :</p>
                                            <p class="col-md-8 col-md-offset-1"><strong>831 Jadloc Parkway, Calumet City,
                                                IL</strong></p>
                                        </div>
                                        <div class="row">
                                            <p class="col-md-3">25 Apr :</p>
                                            <p class="col-md-8 col-md-offset-1"><strong>982 Cemij View</strong></p>
                                        </div>
                                    </div>



                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!--            主显示-->
            <div class="col-md-8" style="background-color: white;height: 820px;padding: 10px;">
                <div id="container" style="position: relative;width: 100%;height: 100%;"></div>
                <div id="panel"></div>
                <div class="row col-md-3 panel newPanel" style="position: absolute;top: 40px;padding: 0;left: 40px;">
                    <div class="panel-body" style="padding: 0;">
                        <div class="col-md-6" style="padding: 5px 10px 5px 10px">
                            <a class="btn btn-primary btn-block"><strong>Add station</strong></a>
                        </div>
                        <div class="col-md-6" style="padding: 5px 10px 5px 10px">
                            <a class="btn btn-primary btn-block"><strong>Add path</strong></a>
                        </div>
                    </div>
                </div>
<!--                <img src="images/hefeimap.png" class="img-responsive" alt="goolemap"-->
<!--                     style="position: relative;width: 100%;height: 100%;">-->

            </div>
        </div>
        <!--body wrapper end-->

        <!--footer section start-->
        <footer style="text-align: center;margin-top: 10px;">
            2022 &copy; AdminEx by AHU ISEC
        </footer>
        <!--footer section end-->


        <input id="stationNames" hidden="hidden" th:value="${stationNames}"/>
        <input id="stationLongitudesAndLatitudes" hidden="hidden" th:value="${stationLongitudesAndLatitudes}"/>
        <input id="pathLists" hidden="hidden" th:value="${pathLists}"/>
        <input id="customerNames" hidden="hidden" th:value="${customerNames}"/>
        <input id="customerLongitudesAndLatitudes" hidden="hidden" th:value="${customerLongitudesAndLatitudes}"/>
        <input id="allCarToCustomerPath" hidden="hidden" th:value="${allCarToCustomerPath}"/>


    </div>
    <!-- main content end-->
</section>
<!--<script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=9802c49d608a80962ed05ccdc9de7723"></script>-->
<script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/jquery-1.11.1.min.js" ></script>
<script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/underscore-min.js" ></script>
<script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/backbone-min.js" ></script>
<script type="text/javascript" src='https://a.amap.com/jsapi_demos/static/demo-center/js/prety-json.js'></script>
<script>

    //将json字符串转为数组 :
    // 1、获取站点名
    // 2、获取站点坐标（与站点名一一对应）
    // 3、获取站点间的路径数组
    var stationName = JSON.parse($('#stationNames').val());
    var stationLongitudesAndLatitudes = JSON.parse($('#stationLongitudesAndLatitudes').val());
    var path = JSON.parse($('#pathLists').val());
    var customerNames = JSON.parse($('#customerNames').val());
    var customerLoAndLa = JSON.parse($('#customerLongitudesAndLatitudes').val());
    var allCarToCustomerPath = JSON.parse($('#allCarToCustomerPath').val());
    // alert(path.length);

    // 地图初始化
    var map = new AMap.Map("container", {
        // center: [112.187017,31.763388],
        resizeEnable: true,
        zoom: 16
    });

    // 绘制站点间的路径
    for (var i = 0; i < path.length; i++) {
        var polyline = new AMap.Polyline({
            path: path[i],
            isOutline: true,
            outlineColor: '#ffeeff',
            borderWeight: 3,
            strokeColor: "#f0f",
            strokeOpacity: 1,
            strokeWeight: 6,
            // 折线样式还支持 'dashed'
            strokeStyle: "dashed",
            // strokeStyle是dashed时有效
            strokeDasharray: [15, 5],
            lineJoin: 'round',
            lineCap: 'round',
            zIndex: 50,
        })
        map.add(polyline);
    }

    // 绘制车站到用户的路径
    for (var i = 0; i < allCarToCustomerPath.length; i++) {
        var polyline = new AMap.Polyline({
            path: allCarToCustomerPath[i],
            isOutline: true,
            outlineColor: '#ffeeff',
            borderWeight: 3,
            strokeColor: "#000",
            strokeOpacity: 1,
            strokeWeight: 6,
            // 折线样式还支持 'dashed'
            strokeStyle: "dashed",
            // strokeStyle是dashed时有效
            strokeDasharray: [15, 5],
            lineJoin: 'round',
            lineCap: 'round',
            zIndex: 50,
        })
        map.add(polyline);
    }


    for (var i = 0; i < stationName.length; i++) {

        // 以不同颜色标出不同种类站点名  仓库：绿色  无人机站点：红色  无人车站点：黑色
        var color;
        if (stationName[i][0] == 'W') {
            color = 'green';
        } else if (stationName[i][0] == 'D') {
            color = 'red';
        } else {
            color = 'black';
        }
        var text1 = new AMap.Text({
            text:stationName[i],
            anchor:'top-left', // 设置文本标记锚点
            draggable:true,
            cursor:'pointer',
            style:{
                'padding': '.75rem 1.25rem',
                'margin-bottom': '1rem',
                'border-radius': '.40rem',
                'background-color': 'white',
                'width': '6rem',
                'border-width': 0,
                'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                'text-align': 'center',
                'font-size': '15px',
                'font-weight': 'bolder',
                'color': color,
                'x-index':'10000'
            },
            position: stationLongitudesAndLatitudes[i]
        });
        text1.setMap(map);

        // 标出站点标记
        var marker = new AMap.Marker({
            icon: '/icon/poi-marker-' + color + '.png',
            position: stationLongitudesAndLatitudes[i],
            offset: new AMap.Pixel(-13, -30)
        });
        marker.setMap(map);
    }


    for (var i = 0; i < customerNames.length; i++) {

        // 标出用户名
        var text1 = new AMap.Text({
            text:customerNames[i],
            anchor:'top-left', // 设置文本标记锚点
            draggable:true,
            cursor:'pointer',
            style:{
                'padding': '.75rem 1.25rem',
                'margin-bottom': '1rem',
                'border-radius': '.40rem',
                'background-color': 'white',
                'width': '6rem',
                'border-width': 0,
                'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                'text-align': 'center',
                'font-size': '15px',
                'font-weight': 'bolder',
                'color': 'blue',
                'x-index':'10000'
            },
            position: customerLoAndLa[i]
        });
        text1.setMap(map);

        // 标出用户蓝色标记
        var marker = new AMap.Marker({
            icon: '//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png',
            position: customerLoAndLa[i],
            offset: new AMap.Pixel(-13, -30)
        });
        marker.setMap(map);
    }

    // // 计算每条路径的距离，并按顺序在首页打印
    // for (var i = path.length - 2; i < path.length; i++) {
    //     var p1 = path[i][0];
    //     var p2 = path[i][1];
    //     // 返回 p1 到 p2 间的地面距离，单位：米
    //     alert(AMap.GeometryUtil.distance(p1, p2));
    // }


    // 视图自动缩放设置
    map.setFitView(null, true, [40, 20, 10, 10]);

</script>

<div th:replace="common :: commonscript"></div>

<!--easy pie chart-->
<script src="/js/easypiechart/jquery.easypiechart.js"></script>
<script src="/js/easypiechart/easypiechart-init.js"></script>

<!--Sparkline Chart-->
<script src="/js/sparkline/jquery.sparkline.js"></script>
<script src="/js/sparkline/sparkline-init.js"></script>

<!--icheck -->
<script src="/js/iCheck/jquery.icheck.js"></script>
<script src="/js/icheck-init.js"></script>

<!-- jQuery Flot Chart-->
<script src="/js/flot-chart/jquery.flot.js"></script>
<script src="/js/flot-chart/jquery.flot.tooltip.js"></script>
<script src="/js/flot-chart/jquery.flot.resize.js"></script>


<!--Morris Chart-->
<script src="/js/morris-chart/morris.js"></script>
<script src="/js/morris-chart/raphael-min.js"></script>

<!--Calendar-->
<script src="/js/calendar/clndr.js"></script>
<script src="/js/calendar/evnt.calendar.init.js"></script>
<script src="/js/calendar/moment-2.2.1.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>


<!--Dashboard Charts-->
<script src="/js/dashboard-chart-init.js"></script>


</body>
</html>
